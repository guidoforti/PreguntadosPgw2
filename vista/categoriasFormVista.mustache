<div class="container my-5">
    <h2 class="mb-4">üõ†Ô∏è ABM de Categor√≠as</h2>

    {{#flash_success}}
        <div class="alert alert-success fw-bold">{{flash_success}}</div>
    {{/flash_success}}

    {{#flash_error}}
        <div class="alert alert-danger fw-bold">{{flash_error}}</div>
    {{/flash_error}}

    <button class="btn btn-primary mb-4" data-bs-toggle="modal" data-bs-target="#modalCategoria">
        + Crear Nueva Categor√≠a
    </button>

    <div class="card shadow-sm">
        <div class="card-header">Categor√≠as Activas</div>
        <div class="card-body p-0">
            <table class="table table-striped table-hover mb-0">
                <thead>
                <tr>
                    <th style="width: 50px;">ID</th>
                    <th>Nombre</th>
                    <th style="width: 150px;">Color</th>
                    <th style="width: 180px;">Acciones</th>
                </tr>
                </thead>
                <tbody>
                {{#categorias}}
                    <tr>
                        <td>{{categoria_id}}</td>
                        <td>{{nombre}}</td>
                        <td>
                            <span class="badge" style="background-color: {{color_hex}};">{{color_hex}}</span>
                        </td>
                        <td>
                            <button class="btn btn-sm btn-warning btn-editar"
                                    data-id="{{categoria_id}}"
                                    data-nombre="{{nombre}}"
                                    data-color="{{color_hex}}"
                                    data-bs-toggle="modal"
                                    data-bs-target="#modalCategoria">
                                Editar
                            </button>
                            <a href="/editor/eliminarCategoria?id={{categoria_id}}"
                            class="btn btn-sm btn-danger"
                            onclick="return confirm('¬øSeguro que deseas eliminar la categor√≠a {{nombre}}? Esto puede fallar si tiene preguntas asociadas.');">
                            Eliminar
                            </a>
                        </td>
                    </tr>
                {{/categorias}}
                {{^categorias}}
                    <tr><td colspan="4" class="text-center text-muted">No hay categor√≠as cargadas.</td></tr>
                {{/categorias}}
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="modal fade" id="modalCategoria" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form action="/editor/guardarCategoria" method="POST">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalLabel">Crear/Editar Categor√≠a</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="categoria_id" id="categoria_id">

                    <div class="mb-3">
                        <label for="nombre" class="form-label">Nombre de la Categor√≠a</label>
                        <input type="text" class="form-control" id="nombre" name="nombre" required>
                    </div>

                    <div class="mb-3">
                        <label for="color_hex" class="form-label">Color (Hexadecimal)</label>
                        <input type="color" class="form-control form-control-color" id="color_hex" name="color_hex" value="#0056b3" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Guardar</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const modal = document.getElementById('modalCategoria');
        modal.addEventListener('show.bs.modal', function (event) {
            const button = event.relatedTarget;
            const form = modal.querySelector('form');
            const modalLabel = modal.querySelector('#modalLabel');

            if (button && button.hasAttribute('data-id')) {
                modalLabel.textContent = 'Editar Categor√≠a';
                form.querySelector('#categoria_id').value = button.getAttribute('data-id');
                form.querySelector('#nombre').value = button.getAttribute('data-nombre');
                form.querySelector('#color_hex').value = button.getAttribute('data-color');
            } else {
                modalLabel.textContent = 'Crear Nueva Categor√≠a';
                form.querySelector('#categoria_id').value = '';
                form.querySelector('#nombre').value = '';
                form.querySelector('#color_hex').value = '#0056b3';
            }
        });
    });
</script>