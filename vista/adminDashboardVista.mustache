<div class="container mt-5 mb-5">
    <div class="row mb-4">
        <div class="col-12">
            <h2 class="mb-4">
                <i class="bi bi-graph-up"></i> Dashboard de Administración
            </h2>
        </div>
    </div>

    <!-- Filtros -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-primary shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Filtros de Período</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="btn-group" role="group" aria-label="Filtros de período">
                                <button type="button" class="btn btn-outline-primary filtro-btn active" data-filtro="mes">
                                    Este Mes
                                </button>
                                <button type="button" class="btn btn-outline-primary filtro-btn" data-filtro="semana">
                                    Esta Semana
                                </button>
                                <button type="button" class="btn btn-outline-primary filtro-btn" data-filtro="dia">
                                    Hoy
                                </button>
                                <button type="button" class="btn btn-outline-primary filtro-btn" data-filtro="año">
                                    Este Año
                                </button>
                            </div>
                        </div>
                        <div class="col-md-4 text-end">
                            <button type="button" class="btn btn-success" id="btnDescargarPDF">
                                <i class="bi bi-file-pdf"></i> Descargar PDF
                            </button>
                            <button type="button" class="btn btn-secondary" id="btnImprimir">
                                <i class="bi bi-printer"></i> Imprimir
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Estadísticas Generales -->
    <div class="row mb-4" id="estadisticasContainer">
        <div class="col-md-4 mb-3">
            <div class="card text-center border-light shadow-sm">
                <div class="card-body">
                    <h6 class="card-title text-muted">Total de Jugadores</h6>
                    <h2 class="card-text text-primary" id="totalJugadores">-</h2>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card text-center border-light shadow-sm">
                <div class="card-body">
                    <h6 class="card-title text-muted">Partidas Jugadas</h6>
                    <h2 class="card-text text-primary" id="totalPartidas">-</h2>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card text-center border-light shadow-sm">
                <div class="card-body">
                    <h6 class="card-title text-muted">Preguntas Activas</h6>
                    <h2 class="card-text text-primary" id="totalPreguntasActivas">-</h2>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card text-center border-light shadow-sm">
                <div class="card-body">
                    <h6 class="card-title text-muted">Preguntas Creadas</h6>
                    <h2 class="card-text text-primary" id="totalPreguntasCreadas">-</h2>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card text-center border-light shadow-sm">
                <div class="card-body">
                    <h6 class="card-title text-muted">Usuarios Nuevos</h6>
                    <h2 class="card-text text-primary" id="usuariosNuevos">-</h2>
                </div>
            </div>
        </div>
    </div>

    <!-- Gráficos -->
    <div class="row">
        <!-- Usuarios por País -->
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Usuarios por País</h5>
                </div>
                <div class="card-body">
                    <div id="chartUsuariosPorPais" style="width: 100%; height: 400px;"></div>
                    <div id="tablaPaisCargando" class="text-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Cargando...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Usuarios por Sexo -->
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Usuarios por Sexo</h5>
                </div>
                <div class="card-body">
                    <div id="chartUsuariosPorSexo" style="width: 100%; height: 400px;"></div>
                    <div id="tablaSexoCargando" class="text-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Cargando...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Usuarios por Grupo de Edad -->
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Usuarios por Grupo de Edad</h5>
                </div>
                <div class="card-body">
                    <div id="chartUsuariosPorGrupoEdad" style="width: 100%; height: 400px;"></div>
                    <div id="tablaEdadCargando" class="text-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Cargando...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Porcentaje de Respuestas Correctas -->
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Porcentaje de Acierto por Usuario (Top 10)</h5>
                </div>
                <div class="card-body" style="height: 400px; overflow-y: auto;">
                    <table class="table table-sm table-striped" id="tablaPorcentajeRespuestas">
                        <thead>
                            <tr>
                                <th>Usuario</th>
                                <th>Porcentaje</th>
                            </tr>
                        </thead>
                        <tbody id="tbody-porcentaje">
                            <tr>
                                <td colspan="2" class="text-center text-muted">Cargando datos...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabla de Usuarios por País (para impresión) -->
    <div class="row mt-5 no-screen" id="tablaImpresion">
        <div class="col-12">
            <h4 class="mb-3">Tabla Detallada: Usuarios por País</h4>
            <div class="table-responsive">
                <table class="table table-striped" id="tablaUsuariosPais">
                    <thead class="table-dark">
                        <tr>
                            <th>País</th>
                            <th>Cantidad de Usuarios</th>
                        </tr>
                    </thead>
                    <tbody id="tbody-paises"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Tabla de Usuarios por Sexo (para impresión) -->
    <div class="row mt-4 no-screen">
        <div class="col-12">
            <h4 class="mb-3">Tabla Detallada: Usuarios por Sexo</h4>
            <div class="table-responsive">
                <table class="table table-striped" id="tablaUsuariosSexo">
                    <thead class="table-dark">
                        <tr>
                            <th>Sexo</th>
                            <th>Cantidad de Usuarios</th>
                        </tr>
                    </thead>
                    <tbody id="tbody-sexo"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Tabla de Usuarios por Grupo de Edad (para impresión) -->
    <div class="row mt-4 no-screen">
        <div class="col-12">
            <h4 class="mb-3">Tabla Detallada: Usuarios por Grupo de Edad</h4>
            <div class="table-responsive">
                <table class="table table-striped" id="tablaUsuariosEdad">
                    <thead class="table-dark">
                        <tr>
                            <th>Grupo de Edad</th>
                            <th>Cantidad de Usuarios</th>
                        </tr>
                    </thead>
                    <tbody id="tbody-edad"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Formulario oculto para PDF -->
<form id="formPDF" method="POST" action="/admin/generarPDF" style="display: none;">
    <input type="hidden" id="filtroPDF" name="filtro" value="mes">
</form>

<!-- Google Charts Library -->
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<!-- JavaScript del Dashboard -->
<script src="/js/dashboard.js"></script>

<style>
    .no-screen {
        display: none;
    }

    @media print {
        .no-screen {
            display: block !important;
        }

        .btn-group,
        .btn-success,
        .btn-secondary,
        #estadisticasContainer,
        .card {
            display: none !important;
        }

        .table {
            font-size: 9pt;
            margin-bottom: 20px;
        }

        h4 {
            page-break-inside: avoid;
            margin-top: 20px;
        }
    }
</style>
